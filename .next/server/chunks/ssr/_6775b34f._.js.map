{"version":3,"sources":["../../../../components/ui/ProductCard.tsx/__nextjs-internal-proxy.mjs","../../../../components/auth/SignOutButton.tsx/__nextjs-internal-proxy.mjs","../../../../app/dashboard/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProductCard = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProductCard() from the server but ProductCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/ui/ProductCard.tsx\",\n    \"ProductCard\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SignOutButton = registerClientReference(\n    function() { throw new Error(\"Attempted to call SignOutButton() from the server but SignOutButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/auth/SignOutButton.tsx\",\n    \"SignOutButton\",\n);\n","import { ProductCard } from '@/components/ui/ProductCard'\nimport { SignOutButton } from '@/components/auth/SignOutButton'\nimport { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\nimport { ProductRow, UserAccessRow } from '@/types/db'\n\nexport const dynamic = 'force-dynamic'\nexport const revalidate = 0\n\nexport default async function DashboardPage() {\n  const cookieStore = await cookies()\n  const baseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || ''\n  const normalizeImageUrl = (u: string) => {\n    try {\n      if (!u) return ''\n      if (u.startsWith('http://') || u.startsWith('https://')) return u\n      return new URL(u, baseUrl).toString()\n    } catch {\n      return u\n    }\n  }\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL || '',\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '',\n    {\n      cookies: {\n        get(name) {\n          return cookieStore.get(name)?.value\n        },\n        set() {},\n        remove() {},\n      },\n    }\n  )\n\n  let user: { id: string } | null = null\n  try {\n    const { data: userData, error: errorUser } = await supabase.auth.getUser()\n    console.log('SSR getUser error:', errorUser?.message)\n    user = userData.user ?? null\n  } catch (e) {\n    console.log('SSR getUser exception:', (e as any)?.message)\n  }\n\n  let products: ProductRow[] = []\n  try {\n    const { data: productsData, error: productsError } = await supabase\n      .from('products')\n      .select('*')\n      .eq('is_active', true)\n    console.log('Products data count:', productsData?.length ?? 0)\n    console.log('Erro Products:', productsError?.message)\n    products = (productsData ?? []) as ProductRow[]\n  } catch (e) {\n    console.log('Products fetch exception:', (e as any)?.message)\n    products = []\n  }\n\n  let access: UserAccessRow[] = []\n  try {\n    if (user?.id) {\n      const { data: accessData, error: errorAccess } = await supabase\n        .from('user_access')\n        .select('product_id, user_id, created_at')\n        .eq('user_id', user.id)\n      console.log('Access data count:', accessData?.length ?? 0)\n      console.log('Erro Access:', errorAccess?.message)\n      access = (accessData ?? []) as UserAccessRow[]\n    } else {\n      console.log('No user; treating access as empty')\n      access = []\n    }\n  } catch (e) {\n    console.log('Access fetch exception:', (e as any)?.message)\n    access = []\n  }\n\n  const accessIds = new Set(access.map((a) => a.product_id))\n  const unlockedProducts = accessIds.size > 0 ? products.filter((p) => accessIds.has(p.id)) : []\n  const lockedProducts = accessIds.size > 0 ? products.filter((p) => !accessIds.has(p.id)) : products\n\n  return (\n    <main className=\"container space-y-10 pb-20\">\n      <header className=\"sticky top-0 z-40 bg-background/70 backdrop-blur border-b border-border\">\n        <div className=\"flex items-center justify-between py-3\">\n          <div className=\"flex items-center gap-3\">\n            <span className=\"inline-flex size-8 items-center justify-center rounded-md bg-panel brand-border\">SK</span>\n            <span className=\"font-display\">SouKore</span>\n          </div>\n          <nav className=\"hidden sm:flex items-center gap-4 text-sm\">\n            <a href=\"/\" className=\"hover:text-white\">Início</a>\n            <a href=\"/dashboard\" className=\"text-white\">Meus Protocolos</a>\n            <a href=\"#\" className=\"hover:text-white\">Configurações</a>\n          </nav>\n          <SignOutButton />\n        </div>\n      </header>\n\n      <section className=\"space-y-6\">\n        <h2 className=\"font-display text-xl\">Seus Protocolos</h2>\n        {unlockedProducts.length === 0 ? (\n          <p className=\"text-sm text-text-secondary\">Nenhum protocolo liberado ainda.</p>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {unlockedProducts.map((p) => (\n              <ProductCard\n                key={p.id}\n                title={p.title}\n                description={p.description}\n                imageUrl={normalizeImageUrl(p.image_url)}\n                primaryHref={`/p/${p.slug}`}\n                primaryLabel=\"Acessar Conteúdo\"\n              />\n            ))}\n          </div>\n        )}\n      </section>\n\n      <section className=\"space-y-6\">\n        <h2 className=\"font-display text-xl\">Suba de Nível</h2>\n        <p className=\"text-sm text-text-secondary\">\n          Conteúdos bloqueados. Passe o mouse para destacar e destravar.\n        </p>\n        {lockedProducts.length === 0 ? (\n          <p className=\"text-sm text-text-secondary\">Nenhum protocolo disponível para desbloqueio.</p>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {lockedProducts.map((p) => (\n              <ProductCard\n                key={p.id}\n                title={p.title}\n                description={p.description}\n                imageUrl={normalizeImageUrl(p.image_url)}\n                locked\n                lockedLabel=\"Desbloquear\"\n              />\n            ))}\n          </div>\n        )}\n      </section>\n    </main>\n  )\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}